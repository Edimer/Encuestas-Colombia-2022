---
title: "Intención de voto elecciones presidenciales Colombia 2022"
subtitle: "Inferencia estadística"
author: "Edimer David Jaramillo"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float:
      smooth_scroll: false
      collapsed: false
    df_print: paged
    code_folding: hide
    css: estilo.css 
    theme: cosmo
    highlight: kate
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE,
                      warning = FALSE, fig.align = "center")

library(tidyverse)
library(readxl)
library(lubridate)
library(splines)
library(broom)
library(infer)
library(plotly)

theme_set(theme_minimal())
```

# Bibliotecas

```{r}
library(tidyverse)
library(readxl)
library(lubridate)
library(splines)
library(broom)
library(infer)
library(plotly)
```

# Funciones

```{r}
source("../functions-R/infer1.R", encoding = "UTF-8")
source("../functions-R/infer2.R", encoding = "UTF-8")
source("../functions-R/infer3.R", encoding = "UTF-8")
source("../functions-R/infer4.R", encoding = "UTF-8")
source("../functions-R/infer5.R", encoding = "UTF-8")
source("../functions-R/test_infer.R", encoding = "UTF-8")
```


# Datos

```{r}
datos <- read_csv("../data/EncuestasColombia2022-Update.csv") %>%
  mutate(
    encuesta = str_to_lower(encuesta),
    encuesta = str_to_sentence(encuesta),
    encuesta = if_else(
      str_detect(encuesta, "Cnc"),
      true = "Cnc",
      false = encuesta
    ),
    encuesta = if_else(
      str_detect(encuesta, "Mosqueteros"),
      true = "Mosqueteros",
      false = encuesta
    )
  )

candidatos <- datos %>% 
  select(where(is.numeric)) %>% 
  select(-c(tamano_de_muestra, margen_de_error)) %>% 
  names()

datos
```

## Inferencias

### Estimación

- En este caso se asume que cada encuesta es una *realización o experimento*, el parámetro de interés es $\mu_p$, que podría ser descrito como el promedio de intención de voto. Esta proporción es de interés estimarla para saber cuál sería el verdadero porcentaje de personas que votaría por un candidato.
- Se proponen tres métodos para estimar la intención de voto:
  - **Inferencia clásica original (infer1):** prueba *t-student* para una población. En este caso la variable de interés (proporción) se mantiene en sus unidades originales.
  - **Inferencia clásica logaritmo (infer2):** prueba *t-student* para una población. En este caso la variable de interés (proporción) se transforma a través de logaritmos.
  - **Inferencia no paramétrica: Bootstrapping (infer3):** implementación de técnicas de remuestreo no paramétrico para estimación puntual y construcción de intervalos de confianza **promedio** de intención de voto. Intervalos de confianza con el método de percentiles.
  - **Inferencia no paramétrica: Bootstrapping (infer4):** implementación de técnicas de remuestreo no paramétrico para estimación puntual y construcción de intervalos de confianza para el **promedio** de intención de voto. Intervalos de confianza con el método de error estándar.
  - **Inferencia no paramétrica: Bootstrapping (infer5):** implementación de técnicas de remuestreo no paramétrico para estimación puntual y construcción de intervalos de confianza para la **mediana** de intención de voto. Intervalos de confianza con el método de percentiles.

```{r}
tabla_infer <- test_infer(n_reps = 10000)
tabla_infer
```

<!-- # Pruebas -->


<!-- ```{r} -->
<!-- media_candidato <- -->
<!--   datos %>%  -->
<!--   pull(gustavo_petro) %>%  -->
<!--   mean(na.rm = TRUE) -->

<!-- media_candidato -->

<!-- desvi_candidato <- -->
<!--   datos %>%  -->
<!--   pull(gustavo_petro) %>%  -->
<!--   sd(na.rm = TRUE) -->

<!-- desvi_candidato -->
<!-- ``` -->

<!-- $$P(X >= 51)$$ -->

<!-- ```{r} -->
<!-- pnorm(q = 51, mean = 34.05121, sd = 11.26968, lower.tail = FALSE) -->

<!-- 1 - pnorm(q = 51, mean = 34.05121, sd = 11.26968, lower.tail = TRUE) -->
<!-- ``` -->

<!-- ```{r} -->
<!-- valor_z <- (51 - media_candidato) / desvi_candidato -->
<!-- valor_z -->

<!-- pnorm(q = valor_z, mean = 0, sd = 1, lower.tail = FALSE) -->

<!-- 1 - pnorm(q = valor_z, mean = 0, sd = 1, lower.tail = TRUE) -->
<!-- ``` -->


<!-- # Inductivo -->

<!-- $$H_0: \mu_{p} = 51 \\ H_1: \mu_{p}  \neq 51$$ -->

<!-- ```{r} -->
<!-- proporcion_candidato <- datos %>%  -->
<!--   pull(gustavo_petro) %>%  -->
<!--   na.omit() -->

<!-- prueba_t <- t.test( -->
<!--   x = proporcion_candidato, -->
<!--   alternative = "two.sided", -->
<!--   conf.level = 0.95, -->
<!--   mu = 51  -->
<!-- ) -->

<!-- prueba_t -->
<!-- ``` -->


<!-- - Prueba para la varianza: -->

<!-- ```{r} -->
<!-- pnorm(q = 51, mean = 37.01442, sd = 11.26968, lower.tail = FALSE) -->
<!-- ``` -->

<!-- ```{r} -->
<!-- val1 <- pnorm(q = 30, mean = 37.01442, sd = 11.26968, lower.tail = TRUE) -->

<!-- val2 <- pnorm(q = 40, mean = 37.01442, sd = 11.26968, lower.tail = TRUE) -->

<!-- val2 - val1 -->

<!-- pnorm(q = 40, mean = 37.01442, sd = 11.26968, lower.tail = FALSE) -->

<!-- 0.7331656 - 0.395535  -->
<!-- ``` -->